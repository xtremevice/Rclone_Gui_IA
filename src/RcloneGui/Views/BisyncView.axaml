<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:RcloneGui.ViewModels"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="RcloneGui.Views.BisyncView"
             x:DataType="vm:BisyncViewModel">
  
  <ScrollViewer>
    <StackPanel Margin="20" Spacing="15">
      <TextBlock Text="Bisync Operations" FontSize="24" FontWeight="Bold" />
      
      <TextBlock Text="Create and manage bidirectional sync operations between remotes" 
                 Foreground="Gray" />

      <Separator />

      <!-- Saved Operations -->
      <StackPanel Spacing="10" IsVisible="{Binding BisyncOperations.Count}">
        <TextBlock Text="Saved Operations" FontWeight="SemiBold" FontSize="16" />
        
        <Border BorderBrush="LightGray" BorderThickness="1" CornerRadius="5" Padding="10" MaxHeight="150">
          <ScrollViewer>
            <ItemsControl ItemsSource="{Binding BisyncOperations}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <Border Padding="8" Margin="4" Background="#F5F5F5" CornerRadius="3">
                    <Grid ColumnDefinitions="*,Auto,Auto">
                      <TextBlock Grid.Column="0" Text="{Binding Name}" VerticalAlignment="Center" FontWeight="SemiBold" />
                      <TextBlock Grid.Column="1" 
                                 Text="{Binding SourceRemote, StringFormat='  {0} â‡„'}" 
                                 Foreground="Gray" 
                                 VerticalAlignment="Center"
                                 Margin="10,0,0,0" />
                      <TextBlock Grid.Column="2" 
                                 Text="{Binding DestinationRemote}" 
                                 Foreground="Gray" 
                                 VerticalAlignment="Center" />
                    </Grid>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </ScrollViewer>
        </Border>

        <StackPanel Orientation="Horizontal" Spacing="10">
          <Button Command="{Binding LoadOperationCommand}" Padding="10,5">
            <TextBlock Text="ðŸ“¥ Load Selected" />
          </Button>
          <Button Command="{Binding DeleteOperationCommand}" 
                  Background="#F44336" 
                  Foreground="White"
                  Padding="10,5">
            <TextBlock Text="ðŸ—‘ï¸ Delete Selected" />
          </Button>
        </StackPanel>
      </StackPanel>

      <Separator />

      <!-- Operation Configuration -->
      <TextBlock Text="Operation Configuration" FontWeight="SemiBold" FontSize="16" />

      <!-- Operation Name -->
      <StackPanel Spacing="5">
        <TextBlock Text="Operation Name" FontWeight="SemiBold" />
        <TextBox Text="{Binding OperationName}" 
                 Width="300" 
                 HorizontalAlignment="Left"
                 Watermark="e.g., Sync Photos" />
      </StackPanel>

      <!-- Source Configuration -->
      <StackPanel Spacing="5">
        <TextBlock Text="Source Remote *" FontWeight="SemiBold" />
        <ComboBox ItemsSource="{Binding AvailableRemotes}"
                  SelectedItem="{Binding SourceRemote}"
                  Width="300"
                  HorizontalAlignment="Left">
          <ComboBox.ItemTemplate>
            <DataTemplate>
              <TextBlock Text="{Binding Name}" />
            </DataTemplate>
          </ComboBox.ItemTemplate>
        </ComboBox>
      </StackPanel>

      <StackPanel Spacing="5">
        <TextBlock Text="Source Path (optional)" FontWeight="SemiBold" />
        <Grid ColumnDefinitions="300,Auto">
          <TextBox Grid.Column="0" 
                   Text="{Binding SourcePath}" 
                   Watermark="e.g., /photos" />
          <Button Grid.Column="1" 
                  Command="{Binding LoadSourcePathsCommand}"
                  Margin="5,0,0,0"
                  Padding="10,5">
            <TextBlock Text="ðŸ“ Browse" />
          </Button>
        </Grid>
      </StackPanel>

      <!-- Destination Configuration -->
      <StackPanel Spacing="5">
        <TextBlock Text="Destination Remote *" FontWeight="SemiBold" />
        <ComboBox ItemsSource="{Binding AvailableRemotes}"
                  SelectedItem="{Binding DestinationRemote}"
                  Width="300"
                  HorizontalAlignment="Left">
          <ComboBox.ItemTemplate>
            <DataTemplate>
              <TextBlock Text="{Binding Name}" />
            </DataTemplate>
          </ComboBox.ItemTemplate>
        </ComboBox>
      </StackPanel>

      <StackPanel Spacing="5">
        <TextBlock Text="Destination Path (optional)" FontWeight="SemiBold" />
        <Grid ColumnDefinitions="300,Auto">
          <TextBox Grid.Column="0" 
                   Text="{Binding DestinationPath}" 
                   Watermark="e.g., /backup/photos" />
          <Button Grid.Column="1" 
                  Command="{Binding LoadDestinationPathsCommand}"
                  Margin="5,0,0,0"
                  Padding="10,5">
            <TextBlock Text="ðŸ“ Browse" />
          </Button>
        </Grid>
      </StackPanel>

      <Separator />

      <!-- Bisync Options -->
      <TextBlock Text="Bisync Options" FontWeight="SemiBold" FontSize="16" />

      <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto,Auto" ColumnSpacing="20" RowSpacing="10">
        <!-- Column 1 -->
        <CheckBox Grid.Column="0" Grid.Row="0" 
                  IsChecked="{Binding Resync}"
                  Content="Resync (first time setup)" />
        
        <CheckBox Grid.Column="0" Grid.Row="1" 
                  IsChecked="{Binding CheckAccess}"
                  Content="Check Access" />
        
        <CheckBox Grid.Column="0" Grid.Row="2" 
                  IsChecked="{Binding CreateEmptySrcDirs}"
                  Content="Create Empty Source Dirs" />
        
        <CheckBox Grid.Column="0" Grid.Row="3" 
                  IsChecked="{Binding RemoveEmptyDirs}"
                  Content="Remove Empty Dirs" />

        <!-- Column 2 -->
        <CheckBox Grid.Column="1" Grid.Row="0" 
                  IsChecked="{Binding DryRun}"
                  Content="Dry Run (test mode)" />
        
        <CheckBox Grid.Column="1" Grid.Row="1" 
                  IsChecked="{Binding Force}"
                  Content="Force" />
      </Grid>

      <StackPanel Spacing="5">
        <TextBlock Text="Max Delete Threshold" FontWeight="SemiBold" />
        <StackPanel Orientation="Horizontal" Spacing="10">
          <TextBox Text="{Binding MaxDelete}" Width="100" />
          <TextBlock Text="%" VerticalAlignment="Center" />
        </StackPanel>
      </StackPanel>

      <StackPanel Spacing="5">
        <TextBlock Text="Conflict Resolution" FontWeight="SemiBold" />
        <ComboBox ItemsSource="{Binding ConflictResolveOptions}"
                  SelectedItem="{Binding ConflictResolve}"
                  Width="200"
                  HorizontalAlignment="Left" />
      </StackPanel>

      <StackPanel Spacing="5">
        <TextBlock Text="Compare Method" FontWeight="SemiBold" />
        <TextBox Text="{Binding CompareFlag}" 
                 Width="300" 
                 HorizontalAlignment="Left"
                 Watermark="size,modtime" />
        <TextBlock Text="Common: size,modtime | size,checksum" 
                   FontSize="11" 
                   Foreground="Gray" />
      </StackPanel>

      <Separator />

      <!-- Command Generation -->
      <StackPanel Spacing="10">
        <TextBlock Text="Generated Command" FontWeight="SemiBold" FontSize="16" />
        
        <CheckBox IsChecked="{Binding ShowMacCommand}"
                  Content="Generate for Mac Silicon (Apple M1/M2/M3)" />

        <Button Command="{Binding GenerateCommandCommand}"
                Background="#2196F3"
                Foreground="White"
                Padding="15,8"
                HorizontalAlignment="Left">
          <StackPanel Orientation="Horizontal" Spacing="5">
            <TextBlock Text="âš™ï¸" />
            <TextBlock Text="Generate Command" />
          </StackPanel>
        </Button>

        <Border BorderBrush="#2196F3" 
                BorderThickness="1" 
                CornerRadius="5" 
                Padding="10"
                Background="#F5F5F5"
                IsVisible="{Binding GeneratedCommand, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
          <SelectableTextBlock Text="{Binding GeneratedCommand}" 
                               TextWrapping="Wrap"
                               FontFamily="Consolas,Courier New,monospace"
                               FontSize="12" />
        </Border>
      </StackPanel>

      <Separator />

      <!-- Action Buttons -->
      <StackPanel Orientation="Horizontal" Spacing="10">
        <Button Command="{Binding RunBisyncCommand}"
                IsEnabled="{Binding !IsLoading}"
                Background="#4CAF50"
                Foreground="White"
                Padding="15,8">
          <StackPanel Orientation="Horizontal" Spacing="5">
            <TextBlock Text="â–¶ï¸" />
            <TextBlock Text="Run Bisync Now" />
          </StackPanel>
        </Button>
        
        <Button Command="{Binding SaveOperationCommand}"
                IsEnabled="{Binding !IsLoading}"
                Background="#FF9800"
                Foreground="White"
                Padding="15,8">
          <StackPanel Orientation="Horizontal" Spacing="5">
            <TextBlock Text="ðŸ’¾" />
            <TextBlock Text="Save Operation" />
          </StackPanel>
        </Button>

        <Button Command="{Binding ClearFormCommand}"
                IsEnabled="{Binding !IsLoading}"
                Padding="15,8">
          <StackPanel Orientation="Horizontal" Spacing="5">
            <TextBlock Text="ðŸ—‘ï¸" />
            <TextBlock Text="Clear" />
          </StackPanel>
        </Button>

        <Button Command="{Binding LoadRemotesCommand}"
                IsEnabled="{Binding !IsLoading}"
                Padding="15,8">
          <StackPanel Orientation="Horizontal" Spacing="5">
            <TextBlock Text="ðŸ”„" />
            <TextBlock Text="Refresh Remotes" />
          </StackPanel>
        </Button>
      </StackPanel>

      <!-- Status Message -->
      <Border IsVisible="{Binding StatusMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
              Background="#E3F2FD"
              BorderBrush="#2196F3"
              BorderThickness="1"
              Padding="10"
              CornerRadius="5">
        <TextBlock Text="{Binding StatusMessage}" 
                   TextWrapping="Wrap"
                   Foreground="#1976D2" />
      </Border>

      <!-- Loading Indicator -->
      <ProgressBar IsIndeterminate="{Binding IsLoading}" 
                   IsVisible="{Binding IsLoading}"
                   Height="4" />

      <!-- Help Text -->
      <Border Background="#FFF3E0" 
              BorderBrush="#FF9800"
              BorderThickness="1" 
              Padding="10" 
              CornerRadius="5"
              Margin="0,10,0,0">
        <StackPanel Spacing="5">
          <TextBlock Text="â„¹ï¸ Bisync Tips" FontWeight="SemiBold" Foreground="#E65100" />
          <TextBlock TextWrapping="Wrap" Foreground="#E65100" FontSize="11">
            â€¢ First time: Enable "Resync" to initialize the bisync operation
          </TextBlock>
          <TextBlock TextWrapping="Wrap" Foreground="#E65100" FontSize="11">
            â€¢ Use "Dry Run" to test before making changes
          </TextBlock>
          <TextBlock TextWrapping="Wrap" Foreground="#E65100" FontSize="11">
            â€¢ Set conflict resolution strategy to handle file conflicts automatically
          </TextBlock>
          <TextBlock TextWrapping="Wrap" Foreground="#E65100" FontSize="11">
            â€¢ Mac Silicon users: Command will use /opt/homebrew/bin/rclone path
          </TextBlock>
        </StackPanel>
      </Border>
    </StackPanel>
  </ScrollViewer>
</UserControl>
